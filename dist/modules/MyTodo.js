define(["app","text!templates/mytodo/main.html","text!templates/mytodo/stats.html","text!templates/mytodo/item.html"],function(e,t,n,r){var i=e.module();return i.Todo=Backbone.Model.extend({idAttribute:"_id",defaults:function(){return{done:!1,order:i.Todos.nextOrder()}},toggle:function(){this.save({done:!this.get("done")})}}),i.Collection=Backbone.Collection.extend({model:i.Todo,url:"/api/todos",done:function(){return this.filter(function(e){return e.get("done")})},remaining:function(){return this.without.apply(this,this.done())},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(e){return e.get("order")}}),i.Todos=new i.Collection,i.TodoView=Backbone.View.extend({tagName:"li",template:_.template(r),events:{"click .check":"toggleDone","dblclick div.todo-text":"edit","click span.todo-destroy":"clear","keypress .todo-input":"updateOnEnter"},initialize:function(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this)},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this.setText(),this},setText:function(){var e=this.model.get("text");this.$(".todo-text").text(e),this.input=this.$(".todo-input"),this.input.bind("blur",_.bind(this.close,this)).val(e)},toggleDone:function(){this.model.toggle()},edit:function(){$(this.el).addClass("editing"),this.input.focus()},close:function(){this.model.save({text:this.input.val()}),$(this.el).removeClass("editing")},updateOnEnter:function(e){e.keyCode==13&&this.close()},remove:function(){$(this.el).remove()},clear:function(){this.model.destroy()}}),i.AppView=Backbone.View.extend({el:$("#main"),template:_.template(t),statsTemplate:_.template(n),events:{"keypress #new-todo":"createOnEnter","keyup #new-todo":"showTooltip","click .todo-clear a":"clearCompleted"},initialize:function(){this.$el.html(this.template),this.input=this.$("#new-todo"),i.Todos.bind("add",this.addOne,this),i.Todos.bind("reset",this.addAll,this),i.Todos.bind("all",this.render,this),i.Todos.fetch()},render:function(){this.$("#todo-stats").html(this.statsTemplate({total:i.Todos.length,done:i.Todos.done().length,remaining:i.Todos.remaining().length}))},addOne:function(e){var t=new i.TodoView({model:e});this.$("#todo-list").append(t.render().el)},addAll:function(){i.Todos.each(this.addOne)},createOnEnter:function(e){var t=this.input.val();if(!t||e.keyCode!=13)return;i.Todos.create({text:t}),this.input.val("")},clearCompleted:function(){return _.each(i.Todos.done(),function(e){e.destroy()}),!1},showTooltip:function(e){var t=this.$(".ui-tooltip-top"),n=this.input.val();t.fadeOut(),this.tooltipTimeout&&clearTimeout(this.tooltipTimeout);if(n==""||n==this.input.attr("placeholder"))return;var r=function(){t.show().fadeIn()};this.tooltipTimeout=_.delay(r,1e3)}}),i});